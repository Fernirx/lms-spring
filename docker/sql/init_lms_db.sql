-- MySQL Script generated by MySQL Workbench
-- Thu Jul 31 23:30:03 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema lms_db
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `lms_db` ;

-- -----------------------------------------------------
-- Schema lms_db
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `lms_db` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_520_ci ;
USE `lms_db` ;

-- -----------------------------------------------------
-- Table `lms_db`.`institutions`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`institutions` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`institutions` (
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `code` VARCHAR(6) NOT NULL,
    `short_name` VARCHAR(20) NOT NULL,
    `full_name` VARCHAR(200) NOT NULL,
    `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    UNIQUE INDEX `code_UNIQUE` (`code` ASC) VISIBLE
)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;

-- -----------------------------------------------------
-- Table `lms_db`.`roles`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`roles` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`roles` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) NOT NULL COMMENT 'Student, Teacher, dept_head, acad_affairs',
  `description` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`users`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`users` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`users` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `role_id` BIGINT NOT NULL,
  `username` VARCHAR(50) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `email` VARCHAR(100) NOT NULL,
  `is_delete` TINYINT(1) NOT NULL DEFAULT 0,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `username_UNIQUE` (`username` ASC) VISIBLE,
  UNIQUE INDEX `email_UNIQUE` (`email` ASC) VISIBLE,
  INDEX `idx_users_role` (`role_id` ASC) VISIBLE,
  CONSTRAINT `fk_users_roles`
    FOREIGN KEY (`role_id`)
    REFERENCES `lms_db`.`roles` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`departments`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`departments` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`departments` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `code` VARCHAR(6) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `code_UNIQUE` (`code` ASC) VISIBLE,
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`majors`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`majors` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`majors` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `department_id` BIGINT NOT NULL,
  `code` VARCHAR(8) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `degree_level` ENUM('Bachelor', 'Engineer', 'Phd') NOT NULL DEFAULT 'Bachelor',
  `description` TEXT NULL DEFAULT NULL,
  `active` TINYINT(1) NOT NULL DEFAULT 1,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `code_UNIQUE` (`code` ASC) VISIBLE,
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE,
  INDEX `fk_majors_departments_idx` (`department_id` ASC) VISIBLE,
  CONSTRAINT `fk_majors_departments`
    FOREIGN KEY (`department_id`)
    REFERENCES `lms_db`.`departments` (`id`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`teachers`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`teachers` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`teachers` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL,
  `department_id` BIGINT NOT NULL,
  `code` VARCHAR(8) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `gender` ENUM('Male', 'Female', 'Other') NULL DEFAULT NULL,
  `dob` DATE NULL DEFAULT NULL,
  `phone` VARCHAR(15) NOT NULL,
  `email` VARCHAR(100) NOT NULL,
  `address` VARCHAR(100) NULL DEFAULT NULL,
  `academic_degree` VARCHAR(100) NULL DEFAULT NULL,
  `lecturer_type` ENUM('FullTime', 'Visiting', 'Adjunct', 'Contractual') NOT NULL,
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE INDEX `teacher_code_UNIQUE` (`code` ASC) VISIBLE,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `user_id_UNIQUE` (`user_id` ASC) VISIBLE,
  UNIQUE INDEX `email_UNIQUE` (`email` ASC) VISIBLE,
  UNIQUE INDEX `phone_UNIQUE` (`phone` ASC) VISIBLE,
  INDEX `fk_teachers_departments_idx` (`department_id` ASC) VISIBLE,
  CONSTRAINT `fk_teachers_users`
    FOREIGN KEY (`user_id`)
    REFERENCES `lms_db`.`users` (`id`),
  CONSTRAINT `fk_teachers_departments`
    FOREIGN KEY (`department_id`)
    REFERENCES `lms_db`.`departments` (`id`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`classes`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`classes` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`classes` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `teacher_id` BIGINT NOT NULL,
  `major_id` BIGINT NOT NULL,
  `code` VARCHAR(8) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `cohort_year` YEAR NOT NULL,
  `created_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `code_UNIQUE` (`code` ASC) VISIBLE,
  INDEX `fk_classes_majors_idx` (`major_id` ASC) VISIBLE,
  INDEX `fk_classes_teachers_idx` (`teacher_id` ASC) VISIBLE,
  CONSTRAINT `fk_classes_majors`
    FOREIGN KEY (`major_id`)
    REFERENCES `lms_db`.`majors` (`id`)
    ON DELETE CASCADE
    ON UPDATE RESTRICT,
  CONSTRAINT `fk_classes_teachers`
    FOREIGN KEY (`teacher_id`)
    REFERENCES `lms_db`.`teachers` (`id`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`students`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`students` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`students` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL,
  `class_id` BIGINT NOT NULL,
  `code` VARCHAR(12) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `gender` ENUM('Male', 'Female', 'Other') NULL DEFAULT NULL,
  `dob` DATE NULL DEFAULT NULL,
  `phone` VARCHAR(15) NOT NULL,
  `email` VARCHAR(100) NOT NULL,
  `address` VARCHAR(100) NULL DEFAULT NULL,
  `enroll_date` DATE NOT NULL,
  `status` ENUM('Active', 'Inactive', 'Graduated', 'Dropped') NOT NULL DEFAULT 'Active',
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE INDEX `student_code_UNIQUE` (`code` ASC) VISIBLE,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `user_id_UNIQUE` (`user_id` ASC) VISIBLE,
  UNIQUE INDEX `phone_UNIQUE` (`phone` ASC) VISIBLE,
  UNIQUE INDEX `email_UNIQUE` (`email` ASC) VISIBLE,
  INDEX `fk_students_classes_idx` (`class_id` ASC) VISIBLE,
  CONSTRAINT `fk_students_users`
    FOREIGN KEY (`user_id`)
    REFERENCES `lms_db`.`users` (`id`),
  CONSTRAINT `fk_students_classes`
    FOREIGN KEY (`class_id`)
    REFERENCES `lms_db`.`classes` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`offices`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`offices` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`offices` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `code` VARCHAR(6) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `code_name_UNIQUE` (`code` ASC, `name` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`employees`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`employees` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`employees` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL,
  `office_id` BIGINT NOT NULL,
  `code` VARCHAR(8) NOT NULL,
  `first_name` VARCHAR(100) NOT NULL,
  `last_name` VARCHAR(100) NOT NULL,
  `gender` ENUM('Male', 'Female', 'Other') NULL DEFAULT NULL,
  `dob` DATE NULL DEFAULT NULL,
  `phone` VARCHAR(15) NOT NULL,
  `email` VARCHAR(100) NOT NULL,
  `position` VARCHAR(100) NULL DEFAULT NULL,
  `joined_date` DATE NOT NULL,
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `user_id_UNIQUE` (`user_id` ASC) VISIBLE,
  UNIQUE INDEX `code_UNIQUE` (`code` ASC) VISIBLE,
  UNIQUE INDEX `phone_UNIQUE` (`phone` ASC) VISIBLE,
  UNIQUE INDEX `email_UNIQUE` (`email` ASC) VISIBLE,
  INDEX `fk_employees_offices_idx` (`office_id` ASC) INVISIBLE,
  CONSTRAINT `fk_academic_staffs_users`
    FOREIGN KEY (`user_id`)
    REFERENCES `lms_db`.`users` (`id`),
  CONSTRAINT `fk_employees_offices`
    FOREIGN KEY (`office_id`)
    REFERENCES `lms_db`.`offices` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`school_years`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`school_years` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`school_years` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `code` VARCHAR(9) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `start_year` YEAR(4) NOT NULL,
  `end_year` YEAR(4) NOT NULL,
  `is_current` TINYINT(1) NOT NULL DEFAULT 0,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `start_end_UNIQUE` (`start_year` ASC, `end_year` ASC) INVISIBLE,
  UNIQUE INDEX `code_UNIQUE` (`code` ASC) INVISIBLE,
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`semesters`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`semesters` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`semesters` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `school_year_id` BIGINT NOT NULL,
  `code` VARCHAR(6) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `start_date` DATE NOT NULL,
  `end_date` DATE NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `dates_UNIQUE` (`start_date` ASC, `end_date` ASC) VISIBLE,
  UNIQUE INDEX `code_UNIQUE` (`code` ASC) VISIBLE,
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE,
  INDEX `fk_semesters_school_years_idx` (`school_year_id` ASC) VISIBLE,
  CONSTRAINT `fk_semesters_school_years`
    FOREIGN KEY (`school_year_id`)
    REFERENCES `lms_db`.`school_years` (`id`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`subjects`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`subjects` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`subjects` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `major_id` BIGINT NOT NULL,
  `code` VARCHAR(8) NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `type` ENUM('Theory', 'Practical') NOT NULL DEFAULT 'Theory',
  `academic_credits` INT UNSIGNED NOT NULL,
  `billing_credits` INT UNSIGNED NOT NULL,
  `description` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `code_UNIQUE` (`code` ASC) VISIBLE,
  INDEX `idx_subjects_major` (`major_id` ASC) VISIBLE,
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE,
  CONSTRAINT `fk_subjects_majors`
    FOREIGN KEY (`major_id`)
    REFERENCES `lms_db`.`majors` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`course_offerings`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`course_offerings` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`course_offerings` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `subject_id` BIGINT NOT NULL,
  `semester_id` BIGINT NOT NULL,
  `group_code` VARCHAR(10) NOT NULL,
  `capacity` INT NOT NULL DEFAULT 0,
  `start_date` DATE NOT NULL,
  `end_date` DATE NOT NULL,
  `description` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `idx_offering_semester` (`semester_id` ASC) VISIBLE,
  UNIQUE INDEX `subject_semester_group_UNIQUE` (`subject_id` ASC, `group_code` ASC, `semester_id` ASC) VISIBLE,
  CONSTRAINT `fk_offerings_subjects`
    FOREIGN KEY (`subject_id`)
    REFERENCES `lms_db`.`subjects` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_offerings_semesters`
    FOREIGN KEY (`semester_id`)
    REFERENCES `lms_db`.`semesters` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`classrooms`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`classrooms` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`classrooms` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `code` VARCHAR(8) NOT NULL,
  `location` VARCHAR(100) NOT NULL,
  `capacity` INT NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `code_UNIQUE` (`code` ASC) VISIBLE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`course_assignments`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`course_assignments` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`course_assignments` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `offering_id` BIGINT NOT NULL,
  `teacher_id` BIGINT NOT NULL,
  `status` ENUM('Pending', 'Approved', 'Rejected', 'Canceled') NOT NULL DEFAULT 'Pending',
  `cancel_reason` TEXT NULL DEFAULT NULL,
  `canceled_at` DATE NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `fk_assign_offerings` (`offering_id` ASC) VISIBLE,
  INDEX `fk_assign_teachers` (`teacher_id` ASC) VISIBLE,
  UNIQUE INDEX `course_offering_teacher_UNIQUE` (`offering_id` ASC, `teacher_id` ASC) VISIBLE,
  CONSTRAINT `fk_assign_offerings`
    FOREIGN KEY (`offering_id`)
    REFERENCES `lms_db`.`course_offerings` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_assign_teachers`
    FOREIGN KEY (`teacher_id`)
    REFERENCES `lms_db`.`teachers` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`schedules`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`schedules` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`schedules` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `classroom_id` BIGINT NOT NULL,
  `assignment_id` BIGINT NOT NULL,
  `day_of_week` ENUM('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun') NOT NULL,
  `start_time` TIME NOT NULL,
  `end_time` TIME NOT NULL,
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `idx_sched_classroom` (`classroom_id` ASC) VISIBLE,
  INDEX `fk_schedules_assignments_idx` (`assignment_id` ASC) VISIBLE,
  CONSTRAINT `fk_schedules_classrooms`
    FOREIGN KEY (`classroom_id`)
    REFERENCES `lms_db`.`classrooms` (`id`),
  CONSTRAINT `fk_schedules_assignments`
    FOREIGN KEY (`assignment_id`)
    REFERENCES `lms_db`.`course_assignments` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`registrations`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`registrations` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`registrations` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `student_id` BIGINT NOT NULL,
  `offering_id` BIGINT NOT NULL,
  `status` ENUM('Registered', 'Cancelled') NOT NULL DEFAULT 'Registered',
  `cancelled_at` TIMESTAMP NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `idx_reg_offering` (`offering_id` ASC) VISIBLE,
  UNIQUE INDEX `student_offering_UNIQUE` (`student_id` ASC, `offering_id` ASC) VISIBLE,
  CONSTRAINT `fk_regs_students`
    FOREIGN KEY (`student_id`)
    REFERENCES `lms_db`.`students` (`id`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT `fk_regs_offerings`
    FOREIGN KEY (`offering_id`)
    REFERENCES `lms_db`.`course_offerings` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`tuition_fees`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`tuition_fees` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`tuition_fees` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `student_id` BIGINT NOT NULL,
  `semester_id` BIGINT NOT NULL,
  `amount_due` DECIMAL(12,2) NOT NULL,
  `amount_paid` DECIMAL(12,2) NOT NULL DEFAULT 0,
  `due_date` DATE NOT NULL,
  `paid_date` DATE NULL DEFAULT NULL,
  `status` ENUM('Unpaid', 'Partial', 'Paid') NOT NULL DEFAULT 'Unpaid',
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `idx_tui_semester` (`semester_id` ASC) VISIBLE,
  UNIQUE INDEX `student_semester_UNIQUE` (`student_id` ASC, `semester_id` ASC) VISIBLE,
  CONSTRAINT `fk_tui_students`
    FOREIGN KEY (`student_id`)
    REFERENCES `lms_db`.`students` (`id`),
  CONSTRAINT `fk_tui_semesters`
    FOREIGN KEY (`semester_id`)
    REFERENCES `lms_db`.`semesters` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`notices`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`notices` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`notices` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(200) NOT NULL,
  `content` TEXT NOT NULL,
  `created_by` BIGINT NOT NULL,
  `audience` ENUM('AllStudents', 'AllTeachers', 'All', 'Department', 'Specific') NOT NULL DEFAULT 'All',
  `target_id` BIGINT NULL DEFAULT NULL,
  `valid_from` DATE NULL DEFAULT NULL,
  `valid_to` DATE NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `idx_notices_creator` (`created_by` ASC) VISIBLE,
  CONSTRAINT `fk_notices_users`
    FOREIGN KEY (`created_by`)
    REFERENCES `lms_db`.`users` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`course_documents`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`course_documents` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`course_documents` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `offering_id` BIGINT NOT NULL,
  `title` VARCHAR(200) NOT NULL,
  `file_url` VARCHAR(255) NOT NULL,
  `uploaded_by` BIGINT NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `idx_docs_offering` (`offering_id` ASC) VISIBLE,
  INDEX `idx_docs_uploader` (`uploaded_by` ASC) VISIBLE,
  CONSTRAINT `fk_docs_offerings`
    FOREIGN KEY (`offering_id`)
    REFERENCES `lms_db`.`course_offerings` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_docs_users`
    FOREIGN KEY (`uploaded_by`)
    REFERENCES `lms_db`.`users` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`grades`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`grades` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`grades` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `registration_id` BIGINT NOT NULL,
  `entered_by` BIGINT NOT NULL,
  `process_score` DECIMAL(5,2) UNSIGNED NULL DEFAULT 0,
  `midterm_score` DECIMAL(5,2) UNSIGNED NULL DEFAULT 0,
  `final_score` DECIMAL(5,2) UNSIGNED NULL DEFAULT 0,
  `process_weight` DECIMAL(5,2) UNSIGNED NOT NULL DEFAULT 10,
  `midterm_weight` DECIMAL(5,2) UNSIGNED NOT NULL DEFAULT 30,
  `final_weight` DECIMAL(5,2) UNSIGNED NOT NULL DEFAULT 60,
  `total_score` DECIMAL(5,2) UNSIGNED NULL,
  `letter_grade` VARCHAR(2) NULL,
  `status` ENUM('Pass', 'Fail') NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `registration_UNIQUE` (`registration_id` ASC) VISIBLE,
  INDEX `idx_grades_entered` (`entered_by` ASC) VISIBLE,
  CONSTRAINT `fk_grades_regs`
    FOREIGN KEY (`registration_id`)
    REFERENCES `lms_db`.`registrations` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_grades_employees`
    FOREIGN KEY (`entered_by`)
    REFERENCES `lms_db`.`employees` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`course_assignment_changes`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`course_assignment_changes` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`course_assignment_changes` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `assignment_id` BIGINT NOT NULL,
  `old_schedule` TEXT NOT NULL,
  `new_schedule` TEXT NOT NULL,
  `changed_by` BIGINT NOT NULL,
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `idx_changes_assign` (`assignment_id` ASC) VISIBLE,
  INDEX `idx_course_assignment_changes_changed_by` (`changed_by` ASC) VISIBLE,
  CONSTRAINT `fk_changes_assign`
    FOREIGN KEY (`assignment_id`)
    REFERENCES `lms_db`.`course_assignments` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_changes_academic_staffs`
    FOREIGN KEY (`changed_by`)
    REFERENCES `lms_db`.`employees` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_520_ci;


-- -----------------------------------------------------
-- Table `lms_db`.`department_heads`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`department_heads` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`department_heads` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `teacher_id` BIGINT NOT NULL,
  `department_id` BIGINT NOT NULL,
  `start_date` DATE NOT NULL,
  `end_date` DATE NULL DEFAULT NULL,
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `fk_heads_teacher_idx` (`teacher_id` ASC) VISIBLE,
  INDEX `fk_heads_department_idx` (`department_id` ASC) VISIBLE,
  UNIQUE INDEX `uq_active_head` (`department_id` ASC, `start_date` ASC) VISIBLE,
  CONSTRAINT `fk_heads_teacher`
    FOREIGN KEY (`teacher_id`)
    REFERENCES `lms_db`.`teachers` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_heads_department`
    FOREIGN KEY (`department_id`)
    REFERENCES `lms_db`.`departments` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`teacher_majors`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`teacher_majors` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`teacher_majors` (
  `teacher_id` BIGINT NOT NULL,
  `major_id` BIGINT NOT NULL,
  `is_primary` TINYINT(1) NOT NULL DEFAULT 0,
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`teacher_id`, `major_id`),
  INDEX `fk_tm_majors_idx` (`major_id` ASC) VISIBLE,
  INDEX `fk_tm_teacher_idx` (`teacher_id` ASC) VISIBLE,
  CONSTRAINT `fk_tm_teachers`
    FOREIGN KEY (`teacher_id`)
    REFERENCES `lms_db`.`teachers` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_tm_majors`
    FOREIGN KEY (`major_id`)
    REFERENCES `lms_db`.`majors` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`exam_schedules`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`exam_schedules` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`exam_schedules` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `offering_id` BIGINT NOT NULL,
  `classroom_id` BIGINT NOT NULL,
  `exam_date` DATE NOT NULL,
  `start_time` TIME NOT NULL,
  `note` TEXT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `offering_id_UNIQUE` (`offering_id` ASC) VISIBLE,
  INDEX `fk_exam_classrooms_idx` (`classroom_id` ASC) VISIBLE,
  CONSTRAINT `fk_exam_offerings`
    FOREIGN KEY (`offering_id`)
    REFERENCES `lms_db`.`course_offerings` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_exam_classrooms`
    FOREIGN KEY (`classroom_id`)
    REFERENCES `lms_db`.`classrooms` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`office_heads`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`office_heads` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`office_heads` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `employee_id` BIGINT NOT NULL,
  `office_id` BIGINT NOT NULL,
  `start_date` DATE NOT NULL,
  `end_date` DATE NULL DEFAULT NULL,
  `note` TEXT NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `fk_office_heads_employees_idx` (`employee_id` ASC) VISIBLE,
  INDEX `fk_office_heads_offices_idx` (`office_id` ASC) VISIBLE,
  UNIQUE INDEX `uq_active_head` (`office_id` ASC, `start_date` ASC) VISIBLE,
  CONSTRAINT `fk_office_heads_employees`
    FOREIGN KEY (`employee_id`)
    REFERENCES `lms_db`.`employees` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_office_heads_offices`
    FOREIGN KEY (`office_id`)
    REFERENCES `lms_db`.`offices` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`conduct_scores`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`conduct_scores` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`conduct_scores` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `student_id` BIGINT NOT NULL,
  `semester_id` BIGINT NOT NULL,
  `score` DECIMAL(4,2) NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `student_semester_unique` (`student_id` ASC, `semester_id` ASC) INVISIBLE,
  INDEX `fk_conduct_scores_semesters_idx` (`semester_id` ASC) INVISIBLE,
  INDEX `fk_conduct_scores_students_idx` (`student_id` ASC) VISIBLE,
  CONSTRAINT `fk_conduct_scores_students`
    FOREIGN KEY (`student_id`)
    REFERENCES `lms_db`.`students` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_conduct_scores_semesters`
    FOREIGN KEY (`semester_id`)
    REFERENCES `lms_db`.`semesters` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`student_credits`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`student_credits` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`student_credits` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `student_id` BIGINT NOT NULL,
  `semester_id` BIGINT NOT NULL,
  `total_credits` INT NOT NULL,
  `passed_credits` INT NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `student_semester_unique` (`student_id` ASC, `semester_id` ASC) INVISIBLE,
  INDEX `fk_student_credits_semesters_idx` (`semester_id` ASC) VISIBLE,
  INDEX `fk_student_credits_students_idx` (`student_id` ASC) VISIBLE,
  CONSTRAINT `fk_student_credits_students`
    FOREIGN KEY (`student_id`)
    REFERENCES `lms_db`.`students` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_student_credits_semesters`
    FOREIGN KEY (`semester_id`)
    REFERENCES `lms_db`.`semesters` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `lms_db`.`course_prerequisites`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `lms_db`.`course_prerequisites` ;

CREATE TABLE IF NOT EXISTS `lms_db`.`course_prerequisites` (
  `subject_id` BIGINT NOT NULL,
  `required_subject_id` BIGINT NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`subject_id`, `required_subject_id`),
  INDEX `fk_prerequisites_required_subject_idx` (`required_subject_id` ASC) INVISIBLE,
  CONSTRAINT `fk_prerequisites_subject`
    FOREIGN KEY (`subject_id`)
    REFERENCES `lms_db`.`subjects` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_prerequisites_required_subject`
    FOREIGN KEY (`required_subject_id`)
    REFERENCES `lms_db`.`subjects` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;